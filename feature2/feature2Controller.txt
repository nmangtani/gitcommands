Controller logic

Modified controller logic
Handle routing